---
description: 
globs: 
alwaysApply: true
---
## General
- This project uses **PHP 8.4**.
- Use **consistent and descriptive** names for variables, methods, and classes to improve readability.
- Follow Laravel's conventions:
  - **Singular** for models (e.g., `User.php`).
  - **Plural** for controllers managing models (e.g., `UsersController.php`).
- For singular functionalities like registration or dashboards, use a singular controller name (e.g., `RegisterController`, `DashboardController`).
- Naming conventions:
  - **PascalCase** for class names.
  - **camelCase** for method names.
  - **snake_case** for database columns.
- **Avoid repeating plain string values** (e.g., statuses). Use an Enum instead, placed in `app\Enums`.
- Prefer `match()` over `switch()` for better readability and maintainability.
- Do **not** install or add Composer packages without prior approval.
- Do **not** create or modify migrations unrelated to the current task.

## Database and Eloquent
- Use **Eloquent ORM** and Query Builder over raw SQL queries whenever possible.
- Create **query scopes** in models when encountering repetitive query patterns.

## Migrations
- Use **descriptive** migration names.

## Routes (Waymaker Paradigm)
- **DO NOT manually define routes** in `web.php`.
- Routes are **automatically generated** by Waymaker based on controller attributes.
- Use Waymaker PHP attributes on controller methods:
  - `#[Get]` for GET requests
  - `#[Post]` for POST requests
  - `#[Patch]` for PATCH requests
  - `#[Delete]` for DELETE requests
  - `#[Put]` for PUT requests
- Route naming convention: Automatically generated as `Controllers.{ControllerName}.{methodName}`.
- Customize routes with attribute parameters:
  - `uri`: Custom URI path
  - `parameters`: Route parameters (e.g., `['project']`)
  - `middleware`: Route-specific middleware
- Set controller route prefix: `protected static string $routePrefix = 'resources';`
- Run `php artisan waymaker:make` to regenerate routes after controller changes.

## Controllers
- Use **resourceful controllers** with only the following public methods: `index`, `show`, `create`, `store`, `edit`, `update`, `destroy`.
- **Private methods** are allowed within controllers.
- **Must use Waymaker attributes** on all public methods:
  ```php
  use HardImpact\Waymaker\{Get, Post, Patch, Delete};
  
  class ProjectController extends Controller
  {
      #[Get]
      public function index(): Response
      
      #[Get(uri: '/projects/create')]
      public function create(): Response
      
      #[Post]
      public function store(Request $request): RedirectResponse
      
      #[Get(parameters: ['project'])]
      public function show(Project $project): Response
  }
  ```
- **Validation**: Always use FormRequest with corresponding DTO for validation.
  - Never use inline validation in controllers.
- Create models using validated data:
  ```php
  $project = Project::create($validated);
  ```
- Update models using validated data:
  ```php
  $project->update($validated);
  ```
- This project uses **Laravel Inertia with Vue**:
  - Always return views using `Inertia::render(viewPath, data)`.
  - Return `Inertia\Response` for GET methods.
  - Return `Illuminate\Http\RedirectResponse` for POST/PATCH/DELETE methods.
  - If a Vue file is missing, create it according to `Frontend.mdc` guidelines.

## FormRequest (Required for all validation)
- **Always use FormRequest** for any validation, regardless of complexity.
- **Never use inline validation** in controllers.
- All FormRequests must use DTOs:
  ```php
  class SongRequest extends FormRequest
  {
      use WithData;
      
      protected function dataClass(): string
      {
          return SongData::class;
      }
  }
  ```
- Use the `WithData` trait from `Spatie\LaravelData`.
- Implement only two methods:
  - `authorize(): bool`
  - `dataClass(): string`
- **Do not implement**:
  - `rules()` → Place validation rules in the DTO.
  - `messages()` → Define validation messages in the DTO.
  - `toData()` → This is automatically handled by `WithData`.

## Models, Factories, and Seeders
- Document **model properties** using PHPDoc annotations.
- Always define **`protected $fillable`** and explicitly list fillable attributes.
- **Disable lazy loading**: Always eager-load relationships.
- Apply **attribute casts** (e.g., for dates and booleans).
- Create a **Factory** for each model.
- Create a **Seeder** for each model.
- Update **factories and seeders** when modifying model properties.
- **Models should be final classes**.

## Testing
- This project uses **Pest** for testing.
- Each new feature must include **Pest tests**, including **controller tests**.
- Do **not** delete tests.
- Do **not** modify unrelated tests.
- If a test fails:
  - Propose the required changes.
  - Get confirmation before modifying the test.

## Static Code Analysis
- We use **Larastan (`larastan/larastan`)** for static analysis.
- Always run `composer analyse` after adding a new feature.
- Use **Larastan level 9**.

## Arrays, Collections, and DTOs
- Prefer **collections (`Illuminate\Support\Collection`)** over arrays.
- Do **not** use plain arrays. Instead, create a **DTO**.
- Use the `spatie/laravel-data` package for DTOs.
- **Do not use validation attributes above DTO properties**.
- All validation rules must be defined in:
  ```php
  public static function rules(): array
  ```

## Forms
- Always create a **DTO** for handling form data in FormRequests.
- Pass DTO instances as a `form` data prop to Inertia views:
  ```php
  return Inertia::render('Auth/Register', [
      'form' => RegisterData::empty(),
  ]);
  ```
- The corresponding Vue file should define the form type automatically.

## Security
- Prevent **SQL injection vulnerabilities** by always using FormRequests to validate user input.
- Avoid exposing sensitive data in responses.
